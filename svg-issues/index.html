<!DOCTYPE html>
<html>

  <head>
  <meta name="google-site-verification" content="nbQ3DH1tU2S227w0_LZKTOi0LhBBzGRYnN_ARxSDuYY" />
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <title>SVGアニメーションを行う上で遭遇したイシュー | Kaffee Kantate</title>
  <meta name="description" content="SVGアニメーションにおけるブラウザ動作環境の違いなど">

  <link rel="stylesheet" href="/css/main.css">
  <link rel="canonical" href="http://blog.kaffeekantate.xyz/svg-issues/">
  <link rel="alternate" type="application/rss+xml" title="Kaffee Kantate" href="http://blog.kaffeekantate.xyz/feed.xml" />

  <meta property="og:title" content="SVGアニメーションを行う上で遭遇したイシュー | Kaffee Kantate" />
  <meta property="og:type" content="article" />
  <meta property="og:description" content="SVGアニメーションにおけるブラウザ動作環境の違いなど" />
  <meta property="og:url" content="http://blog.kaffeekantate.xyz/svg-issues/" />
  <meta property="og:image" content="http://blog.kaffeekantate.xyz/images/title.jpg" />
  <meta property="og:site_name" content="Kaffee Kantate" />
  <meta property="fb:app_id" content="1420984721525609" />

  <link rel="apple-touch-icon" sizes="57x57" href="/apple-touch-icon-57x57.png">
  <link rel="apple-touch-icon" sizes="60x60" href="/apple-touch-icon-60x60.png">
  <link rel="apple-touch-icon" sizes="72x72" href="/apple-touch-icon-72x72.png">
  <link rel="apple-touch-icon" sizes="76x76" href="/apple-touch-icon-76x76.png">
  <link rel="apple-touch-icon" sizes="114x114" href="/apple-touch-icon-114x114.png">
  <link rel="apple-touch-icon" sizes="120x120" href="/apple-touch-icon-120x120.png">
  <link rel="apple-touch-icon" sizes="144x144" href="/apple-touch-icon-144x144.png">
  <link rel="apple-touch-icon" sizes="152x152" href="/apple-touch-icon-152x152.png">
  <link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon-180x180.png">
  <link rel="icon" type="image/png" href="/favicon-32x32.png" sizes="32x32">
  <link rel="icon" type="image/png" href="/android-chrome-192x192.png" sizes="192x192">
  <link rel="icon" type="image/png" href="/favicon-96x96.png" sizes="96x96">
  <link rel="icon" type="image/png" href="/favicon-16x16.png" sizes="16x16">
  <link rel="manifest" href="/manifest.json">
  <meta name="msapplication-TileColor" content="#da532c">
  <meta name="msapplication-TileImage" content="/mstile-144x144.png">
  <meta name="theme-color" content="#ffffff">

  <link href="//maxcdn.bootstrapcdn.com/font-awesome/4.2.0/css/font-awesome.min.css" rel="stylesheet">

</head>


  <body>

    <header class="site-header">

  <div class="wrapper">
    <hgroup class="site-title-group">
    <h1 class="site-title"><a class="site-title" href="/">Kaffee Kantate</a></h1>
    <h3 class="site-subtitle">Life in Vancouver, Tech, Coffee, etc</h3>
    </hgroup>


    <nav class="site-nav">

      <div class="trigger">
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
      </div>
    </nav>

  </div>

</header>


    <div class="page-content">
      <div class="wrapper">
        <div class="post">

  <header class="post-header">
    <h1 class="post-title">SVGアニメーションを行う上で遭遇したイシュー</h1>
    <p class="post-meta">Apr 2, 2016</p>
    <div class="post-tag"><a href="/tag/svg" rel="tag">svg</a>, <a href="/tag/css" rel="tag">css</a></div>
  </header>

  <article class="post-content">
    <p>仕事でSVGアニメーションをやったものの予想以上に大変だったので遭遇したイシューをいくつか。ブラウザ環境に依存する話が多いのであくまで <strong>2016年4月2日</strong> 時点の内容です。</p>

<h2 id="firefox-svgtransform-origin">[Firefox] SVG要素に対してtransform-originが正しく動作しない</h2>

<p>現状だとFirefoxでtransform-originを他のブラウザと同じように動作させるには、</p>

<ul>
  <li><code>transform-box: fill-box;</code>を設定</li>
  <li>preferenceにて<code>svg.transform-origin.enabled</code>を有効</li>
</ul>

<p>にしなければならない模様。</p>

<p>これはtransform及びtransform-originにおけるポジションを規定する<code>transform-box</code>というプロパティがまだW3Cにおいてドラフトだから、という理由からくる実装らしい。なのでSVG要素をtransformさせたい場合は現状JavaScriptを使うしかなさそう。(<a href="https://bugzilla.mozilla.org/show_bug.cgi?id=1209061">Bug 1209061 - transform-origin not applied correctly on svg content</a>)</p>

<blockquote>
  <p>You’d need to set transform-box: fill-box; and also enable the svg.transform-origin.enabled pref (Firefox 41, 42) or the svg.transform-box.enabled pref (Firefox 43).</p>
</blockquote>

<h2 id="ie9-svg">[IE(9以上)] SVG要素を正しいアスペクト比で表示させるには幅と高さの設定が必要</h2>

<p>他のブラウザでは’width’と’height’を設定していなくても問題ないですが、残念ながらIEの場合、元のアスペクト比を保てない。(<a href="http://codepen.io/tomByrer/pen/qEBbzw?editors=110">Test Scaling Of SVG Images In Fluid Layouts</a>)</p>

<blockquote>
  <p>&lt;svg … viewBox=”0 0 500 500” width=”500px” height=”500px” preserveAspectRatio=”xMinYMin meet”&gt;</p>
</blockquote>

<p>pxで値を設定してしまうとレスポンシブにならないため、user-agentがIEのときのみwindow resizeに合わせて縦横の値を調整するようにしました。</p>

<h2 id="chrome-stroke-dasharray">[Chrome] 複雑なパスの場合、stroke-dasharrayを正しく描画できない</h2>

<p>波線状のストロークを描画する<code>stroke-dasharray</code>を複雑なパスに用いるとChromeでは描画されなくなるバグ。どの程度の複雑性なら描画されるのか不明。それぞれのパスが独立していても全体に影響することが多々あったのでファイルサイズや要素数も関係しているのかもと勝手に予想してはいますが…</p>

<p>検索してみるとこの問題を報告しているブログ等が多く見つかるので有名なバグのよう。もとのSVGファイルを修正して破線状のパスを減らすしかないのでは。(<a href="https://bugs.chromium.org/p/chromium/issues/detail?id=364866">SVG stroke-dasharray applies dashes across disconnected (M) path segments.</a>)</p>

<h2 id="snapsvg-animate-api">[Snap.svg] animate APIはパフォーマンスに問題があるため、アニメーションさせたい場合は別の方法との組み合わせを</h2>

<p>SVGを操作するライブラリとして有名な<a href="http://snapsvg.io/">Snap.svg</a>(jQuery for SVGのような役割)ですが、animate APIを使うとかなりパフォーマンスに問題がでます。(<a href="http://www.newicon.net/svg-animation-snapsvg/">Adventures with SVG animation and Snap.svg</a>)</p>

<p>リンク先の記事では以下の通りフレームレートの低さを指摘していますが、CPU使用率もかなり高くなってしまいました。</p>

<blockquote>
  <p>Both scripting and rendering were taking longer than was needed for a clean 60fps framerate…I found a ton of timers firing as each animation loop stacked atop the other. In addition to this, rendering time was also significant</p>
</blockquote>

<p>簡単なアニメーションならVanilla JSで、そうでないならパフォーマンス的にも安定した<a href="http://julian.com/research/velocity/">Velocity.js</a>や<a href="https://greensock.com/gsap">GSAP</a>との併用が必要になります。</p>

<h2 id="illustrator-">[Illustrator] 破線状のラインを多用するとファイルサイズが著しく肥大化</h2>

<p>これはイラストレータ及びSVGファイルの話ですが、破線状のラインを使うと、破線のドットそれぞれにanchor pointが設定されるためファイルサイズが極端に肥大化。破線ライン以外には単純な丸と四角のオブジェクトしか使われていないようなファイルが簡単に1MB近くなったりするので注意。</p>

<p>理由がわからず困っていたところ即答してくれた<a href="http://akiaoki.com/">Aki Aoki</a>氏には感謝。</p>

    <div class="social">
	<div class="fb-like social-button" data-href="https://developers.facebook.com/docs/plugins/" data-layout="button" data-action="like" data-show-faces="true" data-share="false" height="20"></div>

	<a href="https://twitter.com/share" class="twitter-share-button social-button" data-count="none">Tweet</a>

	<a href="http://b.hatena.ne.jp/entry/http://blog.kaffeekantate.xyz/svg-issues/" class="hatena-bookmark-button social-button" data-hatena-bookmark-layout="standard-noballoon" data-hatena-bookmark-lang="en" title="このエントリーをはてなブックマークに追加" target="_blank"><img src="https://b.st-hatena.com/images/entry-button/button-only@2x.png" alt="このエントリーをはてなブックマークに追加" width="20" height="20" style="border: none;" /></a>

</div>


  </article>

</div>

      </div>
    </div>

    <footer class="site-footer">

  <div class="wrapper">

    <div class="footer-col-wrapper">

      <div class="footer-col  footer-col-1">
        <h3>Tags</h3>
        <div class="footer-tags"><a href="/tag/advent" class="set-4">advent</a> <a href="/tag/art" class="set-1">art</a> <a href="/tag/bcit" class="set-5">bcit</a> <a href="/tag/cafe" class="set-1">cafe</a> <a href="/tag/coffee" class="set-2">coffee</a> <a href="/tag/css" class="set-5">css</a> <a href="/tag/english-article" class="set-1">english-article</a> <a href="/tag/font" class="set-1">font</a> <a href="/tag/github" class="set-1">github</a> <a href="/tag/javascript" class="set-2">javascript</a> <a href="/tag/jekyll" class="set-2">jekyll</a> <a href="/tag/montreal" class="set-1">montreal</a> <a href="/tag/museum" class="set-1">museum</a> <a href="/tag/music" class="set-4">music</a> <a href="/tag/svg" class="set-2">svg</a> <a href="/tag/trip" class="set-2">trip</a> <a href="/tag/vancouver" class="set-4">vancouver</a> <a href="/tag/%E5%BE%92%E7%84%B6" class="set-1">徒然</a> <a href="/tag/%E7%95%99%E5%AD%A6" class="set-5">留学</a></div>

      </div>


      <div class="footer-col  footer-col-2">
        <h3>Author</h3>
        <p class="text footer-info">Kay: System engineer in Tokyo -> Student at BCIT -> Web developer in Vancouver. Also writing a English blog in <a href="https://medium.com/@kay_ya">Medium</a></p>
        <ul class="contact-list">
          <li><a href="/feed.xml"><i class="fa fa-rss-square"></i></a></li>
          <li><a href="https://instagram.com/kay_ya8/" target="_blank"><i class="fa fa-instagram"></i></a></li>
          <li><a href="mailto:kay.yamagishi.work@gmail.com"><i class="fa fa-envelope-square"></i></a></li>
        </ul>
      </div>

      <div class="footer-col  footer-col-3">
        <p class="text copyright">&copy; 2016 <a href="/">Kaffee Kantate</a>, Powered by <a href="http://jekyllrb.com/">Jekyll</a></p>
      </div>
    </div>

  </div>

</footer>


  </body>
      <script>
  	// Async Sharing Buttons
	(function(doc, script) {
	  var js,
	      fjs = doc.getElementsByTagName(script)[0],
	      frag = doc.createDocumentFragment(),
	      add = function(url, id) {
	          if (doc.getElementById(id)) {return;}
	          js = doc.createElement(script);
	          js.src = url;
	          id && (js.id = id);
	          frag.appendChild( js );
	      };

	    // Facebook SDK
	    add('//connect.facebook.net/en_US/sdk.js#xfbml=1&appId=1420984721525609&version=v2.2', 'facebook-jssdk');
	    // Twitter SDK
	    add('//platform.twitter.com/widgets.js', 'tweetjs');

	    fjs.parentNode.insertBefore(frag, fjs);
	}(document, 'script'));


  	// Google Analystics
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
    (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
    m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

    ga('create', 'UA-47051831-3', 'auto');
    ga('send', 'pageview');

    // add target='_blank' when href has different hostname
    (function() {
		var links = document.links;
		for (var i = 0; i < links.length; i++) {
			if (links[i].hostname != window.location.hostname) {
				links[i].target = '_blank';
			}
		}
	}());

  </script>

  <script type="text/javascript" src="https://b.st-hatena.com/js/bookmark_button.js" charset="utf-8" async="async"></script>
</html>
